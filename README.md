# Интернет-магазин "Skystore"


[1. Цель проекта](#title1) / 
[2. Описание HTML-страниц](#title2) / 
[3. Контроллеры](#title3) / 
[4. Модели](#title4) / 
[5. Админка](#title5) / 
[6. Кастомные команды](#title6) / 
[7. Шаблонные фильтры/теги](#title7) / 
[8. Django-формы](#title8) / 
[9. Модуль config.py](#title9) / 
[10. Установка проекта](#title10) / 
[11. Получение ключей](#title11) /




# <a id="title1">1. Цель проекта</a>
Создание проекта Django для интернет-магазина "Skystore".
Интернет-магазин для хранения разнообразных плагинов и примеров кода, которые будут продаваться.
1. Получить базовые навыки работы с ***Bootstrap***;
2. Получить базовые навыки работы с ***Django***.




# <a id="title2">2. Описание HTML-страниц</a>

## _Приложение "Catalog" (catalog/templates/catalog/):_

1. Реализованы следующие HTML-страницы:
   - `шаблонные страницы:`
     - ***base.html***: общий (базовый) шаблон для всех пользовательских страниц, который включает общие элементы страницы, такие как шапка, подвал и стили;
     - ***menu.html***: подшаблон, в котором описано главное меню:
       - ссылки для всех пользовательских страниц (навигация между разделами магазина);
       - блок с кнопками аутентификации ("Регистрация", "Войти", "Выйти", "Редактировать профиль", "Изменить пароль") и логикой их отображения в зависимости от текущего состояния пользователя (авторизован или нет).
     - ***paginator.html***: подшаблон, в котором описана пагинация (переключение страниц) для главной страницы.
   - `пользовательские страницы:`
     - ***home.html***: главная страница приложения;
     - ***contacts.html***: страница с контактными данными интернет-магазина;
     - ***product.html***: страница с детальной информацией выбранного продукта;
     - ***add_your_product.html***: страница с формой, которая позволяет пользователю самостоятельно добавлять продукт в БД магазина;
     - ***product_confirm_delete.html***: страница с формой, которая запрашивает у пользователя подтверждение удаления продукта из магазина.

2. Для части страниц в БТ были представлены макеты (макеты размещены по адресу: `media/html_patterns/`):
   - ***media/html_patterns/Home_page.html***: содержит HTML-шаблон для страницы "Главная", согласно прототипа из ТЗ:
   ![Прототип для страницы "Главная"](media/html_patterns/Home_page.png)
   - ***media/html_patterns/Contacts_page.html***: содержит HTML-шаблон для страницы "Контакты", согласно прототипа из ТЗ:
   ![Прототип для страницы "Контакты"](media/html_patterns/Contacts_page.png)
   - Страницы, по которым не было предоставлено явных требований к шаблонам в БТ, реализация выполнялась на основе стилизации предыдущих шаблонов.

## _Приложение "Blog" (blog/templates/blog):_

Реализованы следующие HTML-страницы:
   - `пользовательские страницы:`
     - ***blogs.html***: главная страница приложения;
     - ***article.html***: страница с детальной информацией статьи в блоге;
     - ***add_your_article.html***: страница с формой, которая позволяет пользователю самостоятельно добавлять статью в БД магазина;
     - ***article_confirm_delete.html***: страница с формой, которая запрашивает у пользователя подтверждение удаления статьи.


## _Приложение "Users" (users/templates/users/):_

Реализованы следующие HTML-страницы:
   - `пользовательские страницы:`
     - ***register.html***: страница для регистрации пользователя в магазине;
     - ***login.html***: страница для авторизации зарегистрированного пользователя в магазине;
     - ***user_profile_edit.html***: страница для редактирования профиля пользователя;
     - ***change_password.html***: страница для изменения пароля пользователя.

    


# <a id="title3">3. Описание контроллеров (view)</a>

## _Приложение "Catalog" (catalog/views.py):_

1) В приложении используется определение и обработка представлений с помощью классов (CBV: class-based view):

   - `class CatalogListView(ListView)` - представление для отображения домашней страницы (***home.html***) с пагинацией:
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон home.html.
     - **def get_queryset(self)**: для целей отладки контроллер выводит в консоль последние 5 созданных продуктов.
     - С помощью встроенного инструмента Paginator контроллер создает пагинацию страниц (постраничный вывод товаров на главной странице и переключение между страницами).

   - `class CatalogDetailView(LoginRequiredMixin, DetailView)` - представление для отображения страницы с подробной информацией о продукте (***product.html***):
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон product.html.
         - при рендере шаблона GET-запрос выполняет запрос к модели Product, которая запрашивает по Primary Key (pk) в БД необходимый экземпляр (таблица "catalog_products") и импортирует от туда детальную информацию о продукте для product.html.

   - `class CatalogCreateView(LoginRequiredMixin, CreateView)` - представление для отображения страницы с формой (***add_your_product.html***), которая позволяет пользователю добавлять новые товары в БД:
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон add_your_product.html;
       - **POST-запрос**: контроллер вызывает форму для добавления пользователем нового товара (форма создана в forms.py);
       - **form_valid**: отправка пользователю уведомления о том, что его продукт успешно добавлен.

   - `class CatalogUpdateView(LoginRequiredMixin, UpdateView)` - представление для редактирования продукта в магазине (***add_your_product.html***):
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон add_your_product.html;
       - **POST-запрос**: контроллер вызывает форму для редактирования пользователем существующего товара;
       - **form_valid**: перенаправление на страницу с деталями продукта после успешного редактирования.

   - `class CatalogDeleteView((LoginRequiredMixin, DeleteView))` - представление для удаления продукта в магазине (***product_confirm_delete.html***):
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон product_confirm_delete.html;
       - **POST-запрос**: удаление пользователем существующего товара;
       - **form_valid**: отправка пользователю уведомления о том, что продукт был удален.

   - `class CatalogContactsView(FormView)` - представление для отображения страницы "Контакты" (***contacts.html***).
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон contacts.html;
         - **get_context_data**: при рендере шаблона GET-запрос выполняет запрос к модели ContactsData, которая хранит контактные данные интернет-магазина в БД (таблица "catalog_contacts_data") и импортирует от туда контактные данные для contacts.html;
       - **form_valid** (**POST-запрос**): добавление отзыва пользователя в БД (модель Feedback) и отправка пользователю уведомления о том,
        что его обратная связь успешно отправлена.

   - `class CatalogPublicationView(PermissionRequiredMixin, View)` - представление Модератора для управления публикациями продуктов в магазине ('Опубликовать' / 'Отменить').
     - Обрабатываемые запросы:
       - **post** (**POST-запрос**): метод обрабатывает запрос на то, чтоб опубликовать или отменить публикацию продукта.

2) Настроена маршрутизация для данных контроллеров в модуле ***catalog/urls.py***.
В маршрутизации используется пространство имен app_name = CatalogConfig.name = Catalog.

## _Приложение "Blog" (blog/views.py):_

1) В приложении используется определение и обработка представлений с помощью классов (CBV: class-based view):

   - `class BlogListView(ListView)` - представление для отображения домашней страницы (blogs.html) с пагинацией и счетчиком просмотров:
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон blogs.html;
       - **get_queryset**: для переопределения метода get_queryset() где фильтрую статьи с признаком is_published=True и сортирую их по дате создания (по убыванию)

   - `class BlogDetailView(LoginRequiredMixin, DetailView)` - представление для отображения страницы с подробной информацией о статье (article.html):
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон article.html;
       - **get_object**: переопределяем метод get_object() для увеличения счетчика просмотров (views_counter) при каждом просмотре.

   - `class BlogCreateView(LoginRequiredMixin, CreateView)` - представление для отображения страницы с формой, которая позволяет пользователю добавить новую статью в блог:
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон add_your_article.html;
       - **form_valid**: отправка пользователю уведомления о том, что его статья успешно отправлена.

   - `class BlogUpdateView(LoginRequiredMixin, UpdateView)` - представление для редактирования статьи в блоге:
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон add_your_article.html;
       - **get_success_url**: перенаправление на страницу с деталями статьи после успешного редактирования.

   - `class BlogDeleteView(LoginRequiredMixin, DeleteView)` - представление для удаления статьи в блоге:
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон article_confirm_delete.html;
       - **form_valid**: отправка пользователю уведомления о том, что статья была удалена.

2) Настроена маршрутизация для данных контроллеров в модуле ***blog/urls.py***.

## _Приложение "Users" (users/views.py):_

1) В приложении используется определение и обработка представлений с помощью классов (CBV: class-based view):

   - `class CustomRegisterView(FormView)` - представление для отображения страницы регистрации нового пользователя (***register.html***):
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон register.html;
       - **form_valid** (**POST-запрос**): сохранение нового пользователя и автоматический вход после регистрации;
       - **send_welcome_email** (**POST-запрос**): отправка приветственного письма пользователю после успешной регистрации.

   - `class CustomLoginView(LoginView)` - представление для входа пользователя (***login.html***):
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон login.html;
       - **get_success_url** (**POST-запрос**): явно указываю редирект переопределяя метод, так как обычный вариант в виде "success_url = reverse_lazy('catalog:home_page'" не работал. Django его игнорировал и отправлял на /accounts/profile/;
       - **form_valid** (**POST-запрос**): автоматический вход пользователя после успешной аутентификации.

   - `CustomEditProfileView(LoginRequiredMixin, UpdateView)` - представление для редактирования профиля зарегистрированного пользователя (***user_profile_edit.html***):
     - Обрабатываемые запросы:
       - **GET-запрос**: контроллер рендерит шаблон user_profile_edit.html;
       - **get_object**: возвращаем текущего пользователя, чтобы редактировать только свой профиль; 
       - **form_valid** (**POST-запрос**): сохранение изменений профиля пользователя и запрос отправки уведомления на почту;
       - **send_info_email** (**POST-запрос**): отправка письма пользователю после успешного изменения данных в его профиле.

   - `CustomPasswordChangeView(LoginRequiredMixin, PasswordChangeView)` - представление для изменения пароля пользователя (change_password.html).

2) Настроена маршрутизация для данных контроллеров в модуле ***users/urls.py***.




# <a id="title4">4. Описание моделей (models)</a>

## _Приложение "Catalog" (сatalog/models.py):_

1) Реализация модели ***Category***, которая представляет категорию товаров в интернет-магазине:
   - наименование (category_name);
   - описание (description).

2) Реализация модели ***Product***, которая представляет товар в интернет-магазине.
   - Перечень атрибутов модели:
      - наименование (product_name);
      - описание (description);
      - изображение (image);
      - категория (category);
      - цена за покупку (price);
      - дата создания (created_at);
      - дата последнего изменения (updated_at);
      - признак публикации продукта (is_published).
   - Внутри класса Meta добавлен атрибут ***permissions***, который определяет кастомное право:
     - ("can_change_product_publication", "Может управлять публикацией продукта (опубликовать / отменить)").

3) Реализация модели ***ContactsData*** для хранения контактных данных интернет-магазина:
   - страна (country);
   - ИНН (tax_id);
   - адрес (address).

4) Реализация модели ***Feedback*** для хранения обратной связи от пользователей интернет-магазина:
   - Имя пользователя (name);
   - Телефон пользователя (phone);
   - Сообщение от пользователя (message).

## _Приложение "Blog" (blog/models.py):_

1) Реализация модели ***Article(models.Model)***, которая представляет статью для блога в интернет-магазине:
   - наименование статьи (article_title);
   - описание статьи (article_contents);
   - изображение (image);
   - дата создания (create_at);
   - публикация (is_published);
   - счетчик просмотров (views_counter).

## _Приложение "Users" (users/models.py):_

1) Реализация модели ***UserCustomer(AbstractUser)***, которая представляет представляет пользователя магазина:
   - Включает все основные поля и методы, такие как username, email, first_name, last_name, is_staff, is_active и другие.
   - `Дополнительно определил:`
     - почта пользователя (email);
     - аватар пользователя (avatar);
     - телефон пользователя (phone_number);
     - страна пользователя (country);
     - имя пользователя (first_name);
     - фамилия пользователя (last_name).
   - `Модель UserCustomer(AbstractUser) дополнительно использует кастомный менеджер UserCustomerManager() из "users/managers.py":`
     - ***class UserCustomerManager(BaseUserManager)*** - кастомный менеджер для пользователя без поля username.:
       - метод **def create_user()**: создает и возвращает обычного пользователя;
       - метод **def create_superuser()**: создает и возвращает суперпользователя (админа).




# <a id="title5">5. Описание настроек админки (admin)</a>

## _Приложение "Catalog" (сatalog/admin.py):_

1) Для модели *"Category"* в админке настроено отображение данных (***CategoryAdmin***):
   - Отображаемые поля: "id", "category_name";
   - Поля поиска: "category_name", "description".

2) Для модели *"Product"* в админке настроено отображение данных (***ProductAdmin***):
   - Отображаемые поля: "id", "product_name", "price", "category";
   - Поля фильтрации: "category";
   - Поля поиска: "product_name", "description".

3) Для модели *"ContactsData"* в админке настроено отображение контактных данных (***ContactsDataAdmin***):
   - Отображаемые поля: "country", "tax_id", "address".

4) Для модели *"Feedback"* в админке настроено отображение обратной связи (***FeedbackAdmin***):
   - Отображаемые поля: "id", "name", "phone", "message".

## _Приложение "Blog" (blog/admin.py):_

1) Для модели *"Article"* в админке настроено отображение данных (***ArticleAdmin***):
   - Отображаемые поля: "id", "article_title", "is_published", "create_at";
   - Поля фильтрации: "article_title";
   - Поля поиска: "article_title", "create_at".

## _Приложение "Users" (users/admin.py):_

1) Для модели *"UserAdmin"* в админке настроено отображение данных (***UserCustomerAdmin***):
   - Отображаемые поля: "email", "first_name", "last_name", "is_staff", "is_superuser";
   - Поля поиска: "email", "first_name", "last_name";
   - Добавлены разделы: "groups" - возможность включения пользователя в группы прав, "user_permissions" - управление правами доступов.




# <a id="title6">6. Описание кастомных команд</a>

## _Приложение "Catalog" (сatalog/management/commands/):_

1) Для модели *"Category"* созданы следующие кастомные команды:
   - `create_category_fixture.py` - кастомная команда для СОЗДАНИЯ фикстуры для модели Category;
   - `add_categories.py` - кастомная команда для ЗАГРУЗКИ данных в БД из фикстуры.

2) Для модели *"Product"* созданы следующие кастомные команды:
   - `create_product_fixture.py` - кастомная команда для СОЗДАНИЯ фикстуры для модели Product;
   - `add_products.py` - кастомная команда для ЗАГРУЗКИ данных в БД из фикстуры.

## _Приложение "Blog" (blog/management/commands):_

1) Для модели *"Article"* созданы следующие кастомные команды:
   - `create_article_fixture.py` - кастомная команда для СОЗДАНИЯ фикстуры для модели rticle;
   - `add_articles.py` - кастомная команда для ЗАГРУЗКИ данных в БД из фикстуры.

## _Приложение "Users" (users/management/commands/):_

1) Для модели *"UserCustomer"* созданы следующие кастомные команды:
   - `createadmin.py` - кастомная команда для СОЗДАНИЯ администратора.

2) Для управления правами доступов созданы следующие кастомные команды:
   - `create_groups.py` - кастомная команда для СОЗДАНИЯ группы 'Модератор продуктов' и назначает ей права "can_change_product_publication".



# <a id="title7">7. Описание шаблонных фильтров/тегов</a>

## _Приложение "Catalog" (сatalog/templatetags/):_

Шаблонный фильтр `media_filter(path)` - шаблонный фильтр для изображений, который обрабатывает путь из БД и адаптирует его для HTML-страниц приложения.




# <a id="title8">8. Описание форм для ввода и сохранения пользовательских данных</a>

## _Приложение "Catalog" (сatalog/forms.py):_

1) Форма `ProductForm(forms.ModelForm)` - Django-форма для удобной валидации и пользовательского добавления/обновления продуктов на странице add_your_product.html.
   - Методы формы:
     - `clean_product_name` - валидация атрибута формы 'product_name', которая проверяет отсутствие запрещенных слов в данном поле;
     - `clean_description` - валидация атрибута формы 'description', которая проверяет отсутствие запрещенных слов в данном поле;
     - `clean_price` - валидация атрибута формы 'price', которая проверяет что цена не отрицательная;
     - `clean_image` - валидация формата (JPEG/PNG) и размера (до 5 МБ) загружаемого пользователем изображения.
    
2) Форма `ContactForm(forms.Form)` - Django-форма для заполнения и отправки пользователем обратной связи на странице contacts.html.

## _Приложение "Blog" (blog/forms.py):_

1) Форма `ArticleForm(forms.ModelForm)` - Django-форма для добавления пользователем новой статьи в блоге на странице add_your_article.html.

## _Приложение "Users" (users/forms.py):_

1) Форма `UserCustomerRegistrationForm(UserCreationForm)` - Django-форма для регистрации пользователя на сайте магазина на странице register.html.
   - Методы формы:
     - `clean_email` - валидация атрибута формы 'email', которая явно проверяет уникальность email.
        Функция clean_email() нужна, даже если email уже unique=True в модели как у нас потому что unique=True в
        модели выбрасывает ошибку на уровне БД, но не показывает ее в форме, а clean_email() помогает показать
        пользователю в форме, что такой email уже занят.

2) Форма `UserCustomerLoginForm(AuthenticationForm)` - Django-форма для входа ранее зарегистрированного пользователя на сайт магазина на странице login.html.

3) Форма `UserProfileEditForm(forms.ModelForm)` - Django-форма для редактирования профиля зарегистрированного пользователя на странице user_profile_edit.html.

4) Форма `UserPasswordChangeForm(PasswordChangeForm)` - Django-форма для смены пароля пользователя на странице change_password.html.




# <a id="title9">9. Описание модуля config/config.py</a>
В модуле записан список запрещенных слов (константы), которые будут использоваться в методах валидации определенных полей в формах приложений `Catalog` и `Blog`.

Именно из-за того, что эти запрещенные слова релевантны не только для названия/описания Products (приложение Catalog), но и для Articles (приложение Blog) принято решение хранить это в ***config.py***.

Содержание модуля `config/config.py`:
1. ***FORBIDDEN_WORDS*** = {"казино", "криптовалюта", "крипта", "биржа", "дешево", "бесплатно", "обман", "полиция", "радар"}
2. ***MAX_IMAGE_SIZE***  = 5 * 1024 * 1024
3. ***ALLOWED_IMAGE_FORMATS***  = ["image/jpeg", "image/png"]




# <a id="title10">10. Установка проекта</a>
1. Клонируйте репозиторий:
```
git clone https://github.com/MaksimLakovich/Homework-4-python-DJANGO-PROJECT.git
```
2. Установите зависимости:
```
pip install -r requirements.txt
```




# <a id="title11">11. Получение ключей. Описание файла .env.example</a> 
1. Создайте файл .env в корне проекта из копии подготовленного файла `.env.example`, в котором описаны названия всех переменных, необходимых для работы приложения.
2. Замените значения переменных реальными данными.
3. В модуле `settings.py` существует секретный ключ `SECRET_KEY`, который рекомендуется в целях безопасности хранить в тайне:
4. Файл .env должен содержать данные:
   - Настройки секретного ключа проекта:
     - SECRET_KEY_FOR_PROJECT = *secret_key_here*
   - Настройки дебага (обратить внимание, что в settings.py дебаг дополнительно должен быть описан так: DEBUG = True if os.getenv('DEBUG') == 'True' else False):
     - DEBUG = True
   - Настройки БД:
     - DATABASE_SKYSTORE = *write_here*
     - DATABASE_USER = *write_here*
     - DATABASE_PASSWORD = *write_here*
     - DATABASE_HOST = *write_here*
     - DATABASE_PORT = *write_here*
   - Настройка SMTP-сервера Яндекса для отправки уведомлений пользователям магазина по почте:
     - YANDEX_EMAIL_HOST_USER = '*write_here*'
     - YANDEX_EMAIL_HOST_PASSWORD = '*write_here*'
   - Данные почты и устанавливаемого пароля для создания Администратора с помощью кастомной команды:
     - ADMIN_EMAIL = '*write_here*'
     - ADMIN_PASSWORD = '*write_here*'